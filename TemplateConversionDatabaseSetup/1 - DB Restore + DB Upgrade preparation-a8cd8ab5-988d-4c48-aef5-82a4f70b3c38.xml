<joblist>
  <job>
    <context>
      <options preserveOrder='true'>
        <option name='CLIENT_CODE' required='true' valuesUrl='file:/rundeckpro/optionProviders/ClientCodes.json'>
          <description>This is the client code</description>
        </option>
        <option name='CADN_USERNAME' required='true'>
          <description>Please put your CADN Username</description>
        </option>
        <option name='SADN_USERNAME' required='true'>
          <description>Please put your SADN Username</description>
        </option>
        <option name='DATABASE_NAME' required='true'>
          <description><![CDATA[The Database you try to restore to
example: STMM\_DEV1\_MAIN, BCM\_DEV2\_MAIN]]></description>
        </option>
        <option name='DB_BACKUP' required='true' value='1' values='0,1'>
          <description><![CDATA[This is the option to choose which backup for your DB restore
(Prebackup: 0
Postbackup: 1)]]></description>
        </option>
        <option name='SERVER_PORT' required='true' values='8081,8082,8083'>
          <description><![CDATA[This is the server port name
example: 8081,8082]]></description>
        </option>
        <option name='PREDBUpgradeSQL' value='N' values='N,Y'>
          <description>Flag determining if any SQL script needs to run before the DB Upgrade</description>
        </option>
        <option name='LDAP' value='N' values='N,Y'>
          <description>Flag determining if MT LDAP authentication will be turned on</description>
        </option>
      </options>
    </context>
    <description><![CDATA[DB Restore and DB Upgrade Prep

#### This is the first step of CRIMS Upgrade Job, Read Me before Running this Job

***`The Four Components of This Script:`***

1. PBR (automated procedure for restoring a PROD backup on a TEST server)
2. Customize generic SQL scripts 
3. Executing SQL script for creating SADN login
4. Executing SQL script for (possible) SQL instructions to be executed before DB upgrade

***`Required Fields:`***

1. CLIENT_CODE - Client code
2. CADN_USERNAME - CRIMS user account.  **Only for CRIMS 9.8 +**
3. SADN_USERNAME - SADN user
4. DATABASE_NAME - The Database you try to restore to
5. DB_BACKUP - This is the option to choose which backup for your DB restore
6. SERVER_PORT - Server port 8081,8082
7. PREDBUpgradeSQL - Flag determining if any SQL script needs to run before the DB Upgrade
8. LDAP - Flag determining if MT LDAP authentication will be turned on


]]></description>
    <dispatch>
      <excludePrecedence>true</excludePrecedence>
      <keepgoing>false</keepgoing>
      <rankOrder>ascending</rankOrder>
      <successOnEmptyNodeFilter>true</successOnEmptyNodeFilter>
      <threadcount>1</threadcount>
    </dispatch>
    <executionEnabled>true</executionEnabled>
    <group>TemplateConversionDatabaseSetup</group>
    <id>a8cd8ab5-988d-4c48-aef5-82a4f70b3c38</id>
    <loglevel>DEBUG</loglevel>
    <name>1 - DB Restore + DB Upgrade preparation</name>
    <nodeFilterEditable>true</nodeFilterEditable>
    <nodefilters>
      <filter>tags:17R1,Test</filter>
    </nodefilters>
    <nodesSelectedByDefault>false</nodesSelectedByDefault>
    <scheduleEnabled>true</scheduleEnabled>
    <sequence keepgoing='false' strategy='node-first'>
      <command>
        <description>Restore Database</description>
        <exec>D:\CRIMS_UPG_AUTOMATION\batches\1_1_PBR.bat</exec>
      </command>
      <command>
        <description>Customize SQL Login</description>
        <exec>D:\CRIMS_UPG_AUTOMATION\batches\1_2_CustomizeSQL.bat</exec>
      </command>
      <command>
        <description>Creating SQL Login</description>
        <exec>D:\CRIMS_UPG_AUTOMATION\batches\1_3_CreateLogin.bat</exec>
      </command>
      <command>
        <description>Execute Pre-DB Upgrade Script</description>
        <exec>D:\CRIMS_UPG_AUTOMATION\batches\1_4_PreDBUpgradeSQL.bat</exec>
      </command>
    </sequence>
    <timeout>3h</timeout>
    <uuid>a8cd8ab5-988d-4c48-aef5-82a4f70b3c38</uuid>
  </job>
</joblist>
