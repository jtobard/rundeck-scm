<joblist>
  <job>
    <context>
      <options preserveOrder='true'>
        <option enforcedvalues='true' name='ACTION_STATUS' required='true' values='Add,Remove,Update'>
          <description><![CDATA[The action you want to perform
1. Add Nodes
2. Update Nodes
3. Remove Nodes]]></description>
        </option>
        <option name='COMMIT_MESSAGE' required='true' />
      </options>
    </context>
    <description><![CDATA[This job is to send request to add,update or remove hosts that come from csv file to ansible host and Rundeck resources.xml


__`The CSV template is located at \\\crdrs.local\saas automation folder\ResourcesRequest`__

__`Please download the CSV template and reupload to the share location after you've done modifying the CSV file`__

__`Please see the instructions below on how to fill in the CSV file`__

__`Required Columns in CSV file`__

1. Name - A friendly name to describe your node Example: ACAML 17R1 Test
2. Description - Please describe your node
3. Tags - Tag name for rundeck resources to categorize hosts
   * Currently support "92", "17R2", "Gitlab", "EMEA", "Utilities", "US", "17R1", "98", "Rundeck", "Ansible", "APAC", "NA", "Test", "CRIMS", "Prod", "tbd"
   * For example for your ACAML 17R1 client, you can fill in column with CRIMS,17R1,US (separated by ',')
4. HostName - For example 873766-bcmT2.crdrs.local
5. ChangeTo - If you need to rename your current hostname, please fill in the desired hostname. 
   For example if you need to change 890615-tbd71P13.crdrs.local To 892315-OEW13P13.crdrs.local. Otherwise, please leave it as blank
6. AnsibleSection - Current ansible group 
   * Currently support "linux", "prod_appservers", "upgradev17R1", "upgradev17R2", "upgradev96", "upgradev97", "upgradev98", "vm_checkout"
   * For example for your ACAML 17R1 client, you can fill in column with __`ONE`__ group value from above]]></description>
    <dispatch>
      <excludePrecedence>true</excludePrecedence>
      <keepgoing>false</keepgoing>
      <rankOrder>ascending</rankOrder>
      <successOnEmptyNodeFilter>true</successOnEmptyNodeFilter>
      <threadcount>1</threadcount>
    </dispatch>
    <executionEnabled>true</executionEnabled>
    <group>ResourcesRequest</group>
    <id>265118c3-cfa6-4e9c-9fe0-9d4289f30911</id>
    <loglevel>INFO</loglevel>
    <name>RequestNodesToResourcesBatch</name>
    <nodeFilterEditable>false</nodeFilterEditable>
    <nodefilters>
      <filter>name: Ansible</filter>
    </nodefilters>
    <nodesSelectedByDefault>true</nodesSelectedByDefault>
    <notification>
      <onfailure>
        <email recipients='WeijieLin@crd.com,MatthewTam@crd.com' subject='RUNDECK ${job.name} failure' />
      </onfailure>
      <onsuccess>
        <email recipients='WeijieLin@crd.com,MatthewTam@crd.com' subject='RUNDECK ${job.name} succeed' />
      </onsuccess>
    </notification>
    <scheduleEnabled>true</scheduleEnabled>
    <sequence keepgoing='false' strategy='node-first'>
      <command>
        <description>Add nodes to Rundeck resources and ansible host</description>
        <exec>ansible-playbook /etc/ansible/playbooks/AddhostToResourcesBatch.yml -e 'commit_message="${option.COMMIT_MESSAGE}" user=${job.user.name} action_status=${option.ACTION_STATUS}'</exec>
      </command>
    </sequence>
    <uuid>265118c3-cfa6-4e9c-9fe0-9d4289f30911</uuid>
  </job>
</joblist>
